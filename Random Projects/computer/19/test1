local handle = io.open("outfile", "w")
if handle then
    handle:write([[
-- Declare a function
local function foo( s )
    print( s )
end

foo( "Hello!" )
    ]])
    handle:close()
end
shell.run("outfile")